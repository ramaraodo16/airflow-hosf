[2022-08-09 02:36:56,301] {taskinstance.py:1159} INFO - Dependencies all met for <TaskInstance: Stockdim_update.load_ftp_stage manual__2022-08-09T06:36:46.184026+00:00 [queued]>
[2022-08-09 02:36:56,312] {taskinstance.py:1159} INFO - Dependencies all met for <TaskInstance: Stockdim_update.load_ftp_stage manual__2022-08-09T06:36:46.184026+00:00 [queued]>
[2022-08-09 02:36:56,313] {taskinstance.py:1356} INFO - 
--------------------------------------------------------------------------------
[2022-08-09 02:36:56,313] {taskinstance.py:1357} INFO - Starting attempt 1 of 1
[2022-08-09 02:36:56,313] {taskinstance.py:1358} INFO - 
--------------------------------------------------------------------------------
[2022-08-09 02:36:56,352] {taskinstance.py:1377} INFO - Executing <Task(PythonOperator): load_ftp_stage> on 2022-08-09 06:36:46.184026+00:00
[2022-08-09 02:36:56,356] {standard_task_runner.py:52} INFO - Started process 171701 to run task
[2022-08-09 02:36:56,361] {standard_task_runner.py:79} INFO - Running: ['airflow', 'tasks', 'run', 'Stockdim_update', 'load_ftp_stage', 'manual__2022-08-09T06:36:46.184026+00:00', '--job-id', '206', '--raw', '--subdir', 'DAGS_FOLDER/stock_scd2.py', '--cfg-path', '/tmp/tmp52dxn8qr', '--error-file', '/tmp/tmpsnw2xuby']
[2022-08-09 02:36:56,361] {standard_task_runner.py:80} INFO - Job 206: Subtask load_ftp_stage
[2022-08-09 02:36:56,422] {task_command.py:369} INFO - Running <TaskInstance: Stockdim_update.load_ftp_stage manual__2022-08-09T06:36:46.184026+00:00 [running]> on host osboxes
[2022-08-09 02:36:56,544] {taskinstance.py:1569} INFO - Exporting the following env vars:
AIRFLOW_CTX_DAG_OWNER=NSEstock
AIRFLOW_CTX_DAG_ID=Stockdim_update
AIRFLOW_CTX_TASK_ID=load_ftp_stage
AIRFLOW_CTX_EXECUTION_DATE=2022-08-09T06:36:46.184026+00:00
AIRFLOW_CTX_TRY_NUMBER=1
AIRFLOW_CTX_DAG_RUN_ID=manual__2022-08-09T06:36:46.184026+00:00
[2022-08-09 02:36:56,555] {base.py:68} INFO - Using connection ID 'snowflake_conn_id' for task execution.
[2022-08-09 02:36:56,558] {connection.py:257} INFO - Snowflake Connector for Python Version: 2.7.8, Python Version: 3.8.10, Platform: Linux-5.4.0-74-generic-x86_64-with-glibc2.29
[2022-08-09 02:36:56,558] {connection.py:876} INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
[2022-08-09 02:36:56,559] {connection.py:894} INFO - Setting use_openssl_only mode to False
[2022-08-09 02:36:58,383] {cursor.py:710} INFO - query: [ALTER SESSION SET autocommit=False]
[2022-08-09 02:36:58,483] {cursor.py:734} INFO - query execution done
[2022-08-09 02:36:58,484] {snowflake.py:328} INFO - Running statement: put file:///home/osboxes/Desktop/NSE_OF/ind_nifty*00list.csv @EDW_DEV.EDW.NSE_DAILY_STG;, parameters: None
[2022-08-09 02:36:58,484] {cursor.py:710} INFO - query: [put file:///home/osboxes/Desktop/NSE_OF/ind_nifty*00list.csv @EDW_DEV.EDW.NSE_DA...]
[2022-08-09 02:36:58,881] {cursor.py:734} INFO - query execution done
[2022-08-09 02:36:59,835] {file_transfer_agent.py:574} ERROR - An exception was raised in <bound method SnowflakeStorageClient.prepare_upload of <snowflake.connector.s3_storage_client.SnowflakeS3RestClient object at 0x7f142aab9d90>>
Traceback (most recent call last):
  File "/home/osboxes/.local/lib/python3.8/site-packages/snowflake/connector/file_transfer_agent.py", line 571, in function_and_callback_wrapper
    work(*args, **kwargs),
  File "/home/osboxes/.local/lib/python3.8/site-packages/snowflake/connector/storage_client.py", line 214, in prepare_upload
    self.preprocess()
  File "/home/osboxes/.local/lib/python3.8/site-packages/snowflake/connector/storage_client.py", line 192, in preprocess
    self.get_file_header(meta.dst_file_name)  # Check if file exists on remote
  File "/home/osboxes/.local/lib/python3.8/site-packages/snowflake/connector/s3_storage_client.py", line 408, in get_file_header
    response.raise_for_status()
  File "/home/osboxes/.local/lib/python3.8/site-packages/snowflake/connector/vendored/requests/models.py", line 953, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
snowflake.connector.vendored.requests.exceptions.HTTPError: 403 Client Error: Forbidden for url: https://sfc-prod2-ds1-36-customer-stage.s3.amazonaws.com/aflw-s-p2sy4803/stages/18953b8e-b08f-4f76-ad10-071870318340/ind_nifty200list.csv.gz
[2022-08-09 02:36:59,855] {connection.py:507} INFO - closed
[2022-08-09 02:36:59,909] {connection.py:510} INFO - No async queries seem to be running, deleting session
[2022-08-09 02:37:00,012] {taskinstance.py:1889} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/osboxes/.local/lib/python3.8/site-packages/airflow/operators/python.py", line 171, in execute
    return_value = self.execute_callable()
  File "/home/osboxes/.local/lib/python3.8/site-packages/airflow/operators/python.py", line 189, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
  File "/home/osboxes/airflow/dags/stock_scd2.py", line 25, in load_file_lcl_name
    res1 = lcl_2_stg.run(sql=sql_t)
  File "/home/osboxes/.local/lib/python3.8/site-packages/airflow/providers/snowflake/hooks/snowflake.py", line 332, in run
    cur.execute(sql_statement)
  File "/home/osboxes/.local/lib/python3.8/site-packages/snowflake/connector/cursor.py", line 761, in execute
    data = sf_file_transfer_agent.result()
  File "/home/osboxes/.local/lib/python3.8/site-packages/snowflake/connector/file_transfer_agent.py", line 711, in result
    Error.errorhandler_wrapper(
  File "/home/osboxes/.local/lib/python3.8/site-packages/snowflake/connector/errors.py", line 273, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/home/osboxes/.local/lib/python3.8/site-packages/snowflake/connector/errors.py", line 328, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/home/osboxes/.local/lib/python3.8/site-packages/snowflake/connector/errors.py", line 207, in default_errorhandler
    raise error_class(
snowflake.connector.errors.OperationalError: 253003: 253003: While putting file(s) there was an error: 'HTTPError('403 Client Error: Forbidden for url: https://sfc-prod2-ds1-36-customer-stage.s3.amazonaws.com/aflw-s-p2sy4803/stages/18953b8e-b08f-4f76-ad10-071870318340/ind_nifty200list.csv.gz')', this might be caused by your access to the blob storage provider, or by Snowflake.
[2022-08-09 02:37:00,044] {taskinstance.py:1395} INFO - Marking task as FAILED. dag_id=Stockdim_update, task_id=load_ftp_stage, execution_date=20220809T063646, start_date=20220809T063656, end_date=20220809T063700
[2022-08-09 02:37:00,146] {standard_task_runner.py:92} ERROR - Failed to execute job 206 for task load_ftp_stage (253003: 253003: While putting file(s) there was an error: 'HTTPError('403 Client Error: Forbidden for url: https://sfc-prod2-ds1-36-customer-stage.s3.amazonaws.com/aflw-s-p2sy4803/stages/18953b8e-b08f-4f76-ad10-071870318340/ind_nifty200list.csv.gz')', this might be caused by your access to the blob storage provider, or by Snowflake.; 171701)
[2022-08-09 02:37:00,158] {local_task_job.py:156} INFO - Task exited with return code 1
[2022-08-09 02:37:00,591] {local_task_job.py:273} INFO - 0 downstream tasks scheduled from follow-on schedule check
